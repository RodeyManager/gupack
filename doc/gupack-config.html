<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Gupack 基于gulp的前端自动化构建工具</title>
    <link rel="stylesheet" href="assets/js/highlight/css/monokai-sublime.min.css"/>
    <link rel="stylesheet" href="assets/css/main.css"/>
</head>
<body>

    <header class="header">
        <p>
            <a href="#"><img src="assets/images/gupack-128.png" class="logo" alt="gupack"/></a>
            <a href="#">Gupack 基于gulp的前端自动化构建工具</a>
        </p>
    </header>
    <section class="wrap">
        <div class="code">
            <h5>配置选项</h5>
            <ul>
                <li><span class="field">env</span> 编译环境</li>
                <li><span class="field">sourceDir</span> 源文件路径, 默认为 src</li>
                <li><span class="field">buildDir</span> 编译产出路径, 默认为 build</li>
                <li><span class="field">buildTasks</span> 编译任务 Object</li>
                <li>
                    <strong>任务配置</strong>
                    <ul>
                        <li><span class="field">src</span> 编译的源文件</li>
                        <li><span class="field">dest</span> 对应的编译输出路径, 默认为 build参数配置路径，当值为false时，不进行输出（如ftp任务等）</li>
                        <li><span class="field">rely</span> 当前任务依赖的task列表</li>
                        <li><span class="field">loader</span> 当前任务编译需要的gulp插件列表 Object</li>
                        <li><span class="field">watch</span> 监听变化（文件改变执行该任务），默认为当前任务的 src</li>
                        <li><span class="field">nowatch</span> 禁止监听变化</li>
                        <li><span class="field">run</span> 是否执行当前任务，默认执行，当值为false时，不执行</li>
                        <li><span class="field">babel</span> 是否执行babel转换, 默认参数: presets: [ 'es2015', 'stage-2' ]</li>
                    </ul>
                </li>
            </ul>
        </div>
        <div class="code">
            <p>范例</p>
            <pre><code>
                const
                    nodePath      = require('path'),
                    util            = require('util');

                const
                    argv          = process.argv.slice(2),
                    _envIndex       = argv.indexOf('-e') || argv.indexOf('--env') || -1,

                    //当前编译环境: dev: 开发环境(默认); stg: 测试环境; prd: 生成环境
                    env             = argv[_envIndex + 1] || 'dev',
                    isDev           = env === 'dev',
                    isStg           = env === 'stg',
                    isProduction    = env === 'prd' || env === 'production',
                    isIf            = isStg || isProduction,

                    //静态资源版本控制号
                    vQueryKey       = '_rvc_',
                    hashSize        = 10,
                    //项目编译后的路径
                    buildPath       = nodePath.resolve(__dirname, '../build'),
                    //项目功能配置文件
                    config          = 'config-' + (isDev ? 'dev' : isStg ? 'stg' : isProduction ? 'prd': 'dev') + '.js';

                //导出模块
                module.exports      =  {
                    env: env,
                    // 源文件路径, 默认为 src
                    sourceDir: 'src',
                    // 编译产出路径，可以是绝对或者相对路径，默认为 build
                    buildDir: 'build',
                    // task任务列表
                    buildTasks: {
                        // ---说明：单个任务配置
                        'build.css': {
                            // 源文件
                            src: 'assets/css/**/*',
                            // 额外的插件样式，如果不是每个页面都用到，不建议合并到主样式文件中
                            // 可以单独在使用到的页面中引用
                            plugins: [],
                            dest: 'assets/css',
                            // 依赖task列表
                            rely: ['build.assets'],
                            // gulp插件
                            loader: util._extend({
                                'gulp-merge-css': 'app.min.css'
                            }, cssLoaders()),
                            // 监听变化（文件改变执行该任务）
                            watch: ['assets/css/**/*']
                        },

                        'build.modules': {
                            pathPrefix: 'modules/',
                            src: ['**/*'],
                            //过滤掉不进行编译的文件或目录
                            filters: [
                                'model.js',
                                'view.js',
                                'main.js'
                            ],
                            dest: 'modules',
                            loader: jsLoaders(),
                            watch: [ 'modules/**/*']
                        },

                        'build.views': {
                            src: ['views/**/*.html'],
                            filters: [],
                            dest: '',
                            rely: ['build.assets', 'build.main'],
                            loader: htmlLoaders(),
                            watch: [
                                'views/**/*',
                                'components/**/*',
                                'templates/**/*'
                            ]
                        },

                        'build.main': {
                            src: [
                                'config/' + config,
                                'modules/main.js',
                                'modules/model.js',
                                'modules/view.js'
                            ],
                            dest: 'modules',
                            loader: util._extend({
                                'gulp-concat': 'main.js'
                            }, jsLoaders())
                        },

                        //components目录下所有js进行打包
                        'build.components.js': {
                            src: 'components/**/*.js',
                            dest: 'assets/js',
                            loader: util._extend({
                                'gulp-concat': 'components.js'
                            }, jsLoaders())
                        },

                        //components目录下所有css进行打包
                        'build.components.css': {
                            src: 'components/**/*.{css,scss,less}',
                            dest: 'assets/css',
                            //依赖task列表
                            rely: ['build.assets'],
                            loader: util._extend({
                                'gulp-concat-css': 'components.min.css'
                            }, cssLoaders)
                        },

                        'build.assets': {
                            src: 'assets/{fonts,images,js,libs}/**/*',
                            dest: 'assets',
                            loader: jsLoaders()
                        }

                    }
                };

                function cssLoaders(){
                    return {
                        'gulp-sass': { outputStyle: 'compressed' },
                        'gulp-recache': {
                            _if: isIf,
                            queryKey: vQueryKey,
                            //hash值长度
                            hashSize: hashSize,
                            // 1000字节大小以内的图片转base64,
                            toBase64Limit: 500,
                            //资源根路径
                            basePath: buildPath + '/assets'
                        },
                        'gulp-autoprefixer': {
                            browsers: ['> 5%', 'IE > 8', 'last 2 versions'],
                            cascade: false
                        },
                        'gulp-uglifycss': { _if: isIf }
                    }
                }

                function jsLoaders(){
                    return {
                        'gulp-jsminer': {
                            _if: isIf, preserveComments: '!'
                        }
                    }
                }

                function htmlLoaders(){
                    return {
                        'gulp-tag-include': {
                            compress: isIf
                        },
                        'gulp-recache': {
                            _if: isIf,
                            queryKey: vQueryKey,
                            //hash值长度
                            hashSize: hashSize,
                            // 1000字节大小以内的图片转base64,
                            toBase64Limit: 1000,
                            basePath: buildPath //'D:\\Sites\\test\\web_components\\build'
                        },
                        'gulp-minify-html': {
                            _if: isIf,
                            empty: true,       //去除空属性
                            comments: false,    //去除html注释
                            Spare: false        //属性值保留引号
                        }
                    }
                }
            </code></pre>
        </div>
    </section>
    <footer class="footer"></footer>
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/highlight/highlight.min.js"></script>
    <script>
        $(function(){
            $('pre code').each(function(i, block){
                hljs.highlightBlock(block);
            });
        });
    </script>
</body>
</html>